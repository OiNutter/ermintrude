var Ermintrude=Class.create({initialize:function(a,b){if(!$(a))throw new Error("Element does not exist: "+a);this.options=Object.extend({shape:"lazySusan",bearing:0,tilt:0,minZ:100,maxZ:400,minOpacity:.4,maxOpacity:1,minScale:.4,maxScale:1,duration:600,btnNext:null,btnPrev:null,easing:"sinoidal",clickToFocus:!0,focusBearing:0,debug:!1,childSelector:"li",startingChild:null,reflect:!1,childInFocus:-1,animating:0,classes:{activeClass:"roundabout-in-focus",itemClass:"roundabout-moveable-item",holderClass:"roundabout-holder"}},b||{});var c=360/$$("#"+a+" "+this.options.childSelector).length,d=this.options.startingChild===null?this.options.bearing:this.options.startingChild*c;this.options.bearing=d,this.options.period=c,this.element=$(a).addClassName(this.options.classes.holderClass).setStyle({padding:"0px",position:"relative","z-index":this.options.minZ}),this.options.clickToFocus===!0&&$$("#"+a+" "+this.options.childSelector).each(function(a,b){$(a).observe("click",function(a){var d=this.options.reflect?360-c*b:c*b;return d=this.toFloat(d),this.isInFocus(d)||(a.stop(),this.options.animating===0&&this.animateAngleToFocus(d)),!1}.bind(this))}.bind(this)),this.options.btnNext&&$(this.options.btnNext).observe("click",function(a){a.stop(),this.options.animating===0&&this.animateToNextChild()}.bind(this)),this.options.btnPrev&&$(this.options.btnPrev).observe("click",function(a){a.stop(),this.options.animating===0&&this.animateToPreviousChild()}.bind(this)),this.startChildren()},startChildren:function(){$$("#"+this.element.id+" "+this.options.childSelector).each(function(a,b){var c=this.options.reflect===!0?360-this.options.period*b:this.options.period*b;$(a).addClassName(this.options.classes.itemClass).setStyle({position:"absolute"}),$(a).roundabout={startWidth:$(a).getWidth(),startHeight:$(a).getHeight(),startFontSize:parseInt($(a).getStyle("fontSize"),10),degrees:c}},this),this.updateChildPositions()},setTilt:function(a){this.options.tilt=a,this.updateChildPositions()},setBearing:function(a){this.options.bearing=this.toFloat(a),this.updateChildPositions();if(Object.isFunction(arguments[1])){var b=arguments[1];setTimeout(function(){b()}.bind(this),0)}},adjustBearing:function(a){a=this.toFloat(a),a!==0&&(this.options.bearing=this.getBearing()+a,this.updateChildPositions())},adjustTilt:function(a){a=this.toFloat(a),a!==0&&(this.options.tilt=this.toFloat(this.get("tilt")+a),this.updateChildPositions())},animateToBearing:function(a){a=this.toFloat(a);var b=new Date,c=Object.isUndefined(arguments[1])?this.options.duration:arguments[1],d=Object.isUndefined(arguments[2])?this.options.easing:arguments[2],e=Object.isUndefined(arguments[3])?null:arguments[3],f;e===null&&(e={timerStart:b,start:this.getBearing(),totalTime:c}),timer=b-e.timerStart,timer<c?(this.options.animating=1,pos=timer/c,f=Effect.Transitions[d](pos)*(a-e.start)+e.start,this.setBearing(f,function(){this.animateToBearing(a,c,d,e)}.bind(this))):(a=a<0?a+360:a%360,this.options.animating=0,this.setBearing(a))},animateToDelta:function(a){var b=arguments[1],c=arguments[2];a=this.getBearing()+this.toFloat(a),this.animateToBearing(a,b,c)},animateToChild:function(a){var b=arguments[1],c=arguments[2],d;this.options.childInFocus!==a&&this.options.animating===0&&(d=$$("#"+this.element.id+" "+this.options.childSelector)[a],this.animateAngleToFocus(d.roundabout.degrees,b,c))},animateToNearbyChild:function(a,b){var c=a[0],d=a[1],e=this.toFloat(360-this.getBearing()),f=this.options.period,g=0,h,i=this.options.reflect,j=$$("#"+this.element.id+" "+this.options.childSelector).length;e=i===!0?e%360:e;if(this.options.animating===0)if(i===!1&&b==="next"||i===!0&&b!=="next"){e=e===0?360:e;while(!0&g<j){h={lower:this.toFloat(f*g),upper:this.toFloat(f*(g+1))},h.upper=g==j-1?360:h.upper;if(e<=h.upper&&e>h.lower){this.animateToDelta(e-h.lower,c,d);break}g++}}else for(;;){h={lower:this.toFloat(f*g),upper:this.toFloat(f*(g+1))},h.upper=g==j-1?360:h.upper;if(e>=h.lower&&e<h.upper){this.animateToDelta(e-h.upper,c,d);break}g++}},animateToNextChild:function(){this.animateToNearbyChild(arguments,"next")},animateToPreviousChild:function(){this.animateToNearbyChild(arguments,"previous")},animateAngleToFocus:function(a){var b=arguments[1],c=arguments[2],d=this.getBearing()-a;d=Math.abs(360-d)<Math.abs(0-d)?360-d:0-d,d=d>180?-(360-d):d,d!==0&&this.animateToDelta(d,b,c)},updateChildPositions:function(){var a=-1;info={bearing:this.getBearing(),tilt:this.options.tilt,stage:{width:Math.floor(this.element.getWidth()*.9),height:Math.floor(this.element.getHeight()*.9)},animating:this.options.animating,inFocus:this.options.childInFocus,focusBearingRad:this.degToRad(this.options.focusBearing),shape:Ermintrude[this.options.shape]},info.midStage={width:info.stage.width/2,height:info.stage.height/2},info.nudge={width:info.midStage.width+info.stage.width*.05,height:info.midStage.height+info.stage.height*.05},info.zValues={min:this.options.minZ,max:this.options.maxZ,diff:this.options.maxZ-this.options.minZ},info.opacity={min:this.options.minOpacity,max:this.options.maxOpacity,diff:this.options.maxOpacity-this.options.minOpacity},info.scale={min:this.options.minScale,max:this.options.maxScale,diff:this.options.maxScale-this.options.minScale},$$("#"+this.element.id+" "+this.options.childSelector).each(function(b,c){this.updateChildPosition(b,info,c)&&info.animating===0?(a=c,$(b).addClassName(this.options.classes.activeClass)):$(b).removeClassName(this.options.classes.activeClass)},this),a!==info.inFocus&&(this.triggerEvent(info.inFocus,"blur"),a!==-1&&this.triggerEvent(a,"focus"),this.options.childInFocus=a)},getBearing:function(){return this.options.bearing%360},degToRad:function(a){return a%360*Math.PI/180},isInFocus:function(a){return this.getBearing()%360===a%360},triggerEvent:function(a,b){return a<0?this:$$("#"+this.element.id+" "+this.options.childSelector)[a].fire(b)},toFloat:function(a){return a=Math.round(parseFloat(a)*1e3)/1e3,parseFloat(a.toFixed(2))},updateChildPosition:function(a,b,c){var d=a.roundabout,e=[],f=this.degToRad(360-d.degrees+b.bearing),g;while(f<0)f=f+Math.PI*2;while(f>Math.PI*2)f=f-Math.PI*2;return g=b.shape(f,b.focusBearingRad,b.tilt),g.scale=g.scale>1?1:g.scale,g.adjustedScale=(b.scale.min+b.scale.diff*g.scale).toFixed(4),g.width=(g.adjustedScale*d.startWidth).toFixed(4),g.height=(g.adjustedScale*d.startHeight).toFixed(4),$(a).setStyle({left:(g.x*b.midStage.width+b.nudge.width-g.width/2).toFixed(1)+"px",top:(g.y*b.midStage.height+b.nudge.height-g.height/2).toFixed(1)+"px",width:g.width+"px",height:g.height+"px",opacity:(b.opacity.min+b.opacity.diff*g.scale).toFixed(2),zIndex:Math.round(b.zValues.min+b.zValues.diff*g.z),fontSize:(g.adjustedScale*d.startFontSize).toFixed(2)+"px"}).writeAttribute("current-scale",g.adjustedScale),this.isInFocus(d.degrees)}});Ermintrude.lazySusan=function(a,b,c){return{x:Math.sin(a+b),y:Math.sin(a+3*Math.PI/2+b)/8*c,z:(Math.cos(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}},Ermintrude.theJuggler=function(a,b,c){return{x:Math.sin(a+b),y:Math.tan(Math.exp(Math.log(a))+b)/(c-1),z:(Math.cos(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}},Ermintrude.figure8=function(a,b,c){return{x:Math.sin(a*2+b),y:Math.sin(a+Math.PI/2+b)/8*c,z:(Math.cos(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}},Ermintrude.waterWheel=function(a,b,c){return{x:Math.sin(a+Math.PI/2+b)/8*c,y:Math.sin(a+b)/(Math.PI/2),z:(Math.cos(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}},Ermintrude.square=function(a,b,c){var d,e,f;return a<=Math.PI/2?(d=2/Math.PI*a,e=-(2/Math.PI)*a+1,f=-(1/Math.PI)*a+1):a>Math.PI/2&&a<=Math.PI?(d=-(2/Math.PI)*a+2,e=-(2/Math.PI)*a+1,f=-(1/Math.PI)*a+1):a>Math.PI&&a<=3*Math.PI/2?(d=-(2/Math.PI)*a+2,e=2/Math.PI*a-3,f=1/Math.PI*a-1):(d=2/Math.PI*a-4,e=2/Math.PI*a-3,f=1/Math.PI*a-1),{x:d,y:e*c,z:f,scale:f}},Ermintrude.conveyorBeltLeft=function(a,b,c){return{x:-Math.cos(a+b),y:Math.cos(a+3*Math.PI/2+b)/8*c,z:(Math.sin(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}},Ermintrude.conveyorBeltRight=function(a,b,c){return{x:Math.cos(a+b),y:Math.cos(a+3*Math.PI/2+b)/8*c,z:(Math.sin(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}},Ermintrude.goodbyeCruelWorld=function(a,b,c){return{x:Math.sin(a+b),y:Math.tan(a+3*Math.PI/2+b)/8*(c+.5),z:(Math.sin(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}},Ermintrude.diagonalRingLeft=function(a,b,c){return{x:Math.sin(a+b),y:-Math.cos(a+Math.tan(Math.cos(b)))/(c+1.5),z:(Math.cos(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}},Ermintrude.diagonalRingRight=function(a,b,c){return{x:Math.sin(a+b),y:Math.cos(a+Math.tan(Math.cos(b)))/(c+1.5),z:(Math.cos(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}},Ermintrude.rollerCoaster=function(a,b,c){return{x:Math.sin(a+b),y:Math.sin((2+c)*a),z:(Math.cos(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}},Ermintrude.tearDrop=function(a,b,c){return{x:Math.sin(a+b),y:-Math.sin(a/2+c)+.35,z:(Math.cos(a+b)+1)/2,scale:Math.sin(a+Math.PI/2+b)/2+.5}}
